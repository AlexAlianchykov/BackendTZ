# BackendTZ
Этот проект представляет собой RESTful API, разработанный с использованием Entity Framework Core, используя подход  "Code First". API работает через swagger, предоставляет доступ к данным из базы данных MS SQL, поддерживает создание, чтение, обновление и удаление (CRUD) операций.
## Что делает проект 
BackendTZ разработан для выполнения двух эксперементов компании. В одном эксперементе изменяется цвкт кнопки на сайте у пользователя, за этот эксперемент отвечает конечная точка __[HttpGet("ButtonColor/{devicetoken}")]__, в другом  - изменение цены для пользователя, за этот эксперемент отвечает конечная точка __[HttpGet("ButtonPrice/{devicetoken}")]__. 
## Краткое описание работы проекта 
User при запросе к API проекта, генерирует уникальный device-token. Этот device-token обрабатывается на одной из конечных точек проверяя :
1. Новый ли это user - записывает его в бд, прикрепляя его к этому эксперементу и выдаёт одну из опций эксперемента.

   _если user уже записан в бд, то проводится вторая проверка:_ 
3. Является ли user участником этого эксперимента - выдаётся название эксперемента и опция которую user получил изначально.
   
Если проверка первого и второго пункта провалилась, то выдаётся ошибка, ведь user участвует в другом эксперименте и не должен участвовать в этом. 
### Работа конечной точки на примере [HttpGet("ButtonColor/{devicetoken}")]
Новый user, запрос через swagger: 

![image](https://github.com/user-attachments/assets/d8c289fd-b835-4ece-9cc2-473e1243e28f)

Запрос выполнен удачно и вернулся код 200 c названием эксперимента и опцией для этого user

О том что это именно новый user мы можем убедиться просмотрев логи 

![image](https://github.com/user-attachments/assets/193a3ce6-7e37-4b91-9189-c1847c32900c)

__Как это работает ?__

В начале мы проверяем есть ли user в бд 

```
var number = _db.Users.FirstOrDefault(u => u.DeviceToken == devicetoken);
```

Затем (так как его нет в бд) рандомно присваеваем ему значение опции (в прапорциях указанных в тз), название этого эксперемента и сохраняем всё в бд. 




Такой же запрос мы могли бы сделать напрямую из командной строки 

![image](https://github.com/user-attachments/assets/66e72f3c-681e-4005-b574-3b53fd40c8a1)

Но во вотром случае запрос для user с device-token = 589, будет иметь другую логику выполнения ведь такой юзер уже находиться в бд. 
